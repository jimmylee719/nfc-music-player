<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFC éŸ³æ¨‚å¡æ’­æ”¾å™¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #000;
            color: #fff;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .status {
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
            background-color: #333;
        }
        .status.ready {
            background-color: #4CAF50;
        }
        .status.error {
            background-color: #ff4444;
        }
        .status.info {
            background-color: #333;
        }
        #imageDisplay {
            max-width: 100%;
            height: auto;
            margin: 20px 0;
            border-radius: 10px;
        }
        .audio-container {
            background-color: #222;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
        }
        .loop-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #4CAF50;
            font-size: 20px;
        }
        .custom-audio {
            width: 100%;
            height: 40px;
            background-color: #333;
            border-radius: 5px;
            overflow: hidden;
        }
        .custom-audio::-webkit-media-controls-download-button {
            display: none;
        }
        .browser-support {
            margin-top: 20px;
            padding: 10px;
            background-color: #333;
            color: #fff;
            border-radius: 5px;
        }
        .hidden {
            display: none;
        }
        .nfc-instructions {
            margin: 20px 0;
            padding: 15px;
            background-color: #333;
            border-radius: 5px;
        }
        .input-group {
            margin: 20px 0;
        }
        .input-group input {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            background-color: #333;
            color: #fff;
            border: 1px solid #555;
            border-radius: 5px;
        }
        .input-group button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px 0;
        }
        .input-group button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>NFC éŸ³æ¨‚å¡æ’­æ”¾å™¨</h1>
        <div id="status" class="status">è«‹æ„Ÿæ‡‰æ‚¨çš„ NFC å¡ç‰‡...</div>
        
        <div id="browserSupport" class="browser-support">
            <div id="webNfcSupport" class="hidden">
                æç¤ºï¼šè«‹ä½¿ç”¨ Chrome for Android ç€è¦½å™¨ï¼Œä¸¦å°‡ NFC å¡ç‰‡é è¿‘è¨­å‚™ã€‚
            </div>
            <div id="otherBrowserSupport" class="hidden">
                æç¤ºï¼šè«‹ä½¿ç”¨æ”¯æ´ NFC çš„æ‡‰ç”¨ç¨‹å¼ï¼ˆå¦‚ NFC Toolsï¼‰è®€å–å¡ç‰‡ï¼Œç„¶å¾Œå°‡è®€å–åˆ°çš„æ•¸æ“šè¼¸å…¥ä¸‹æ–¹ã€‚
            </div>
        </div>

        <div id="manualInput" class="input-group hidden">
            <input type="text" id="nfcData" placeholder="è«‹è¼¸å…¥å¾ NFC å¡ç‰‡è®€å–åˆ°çš„æ•¸æ“š">
            <button onclick="handleManualInput()">é©—è­‰ä¸¦æ’­æ”¾</button>
        </div>

        <div class="nfc-instructions">
            <h3>å¦‚ä½•ä½¿ç”¨ï¼š</h3>
            <ol>
                <li>ä½¿ç”¨æ”¯æ´ NFC çš„æ‡‰ç”¨ç¨‹å¼ï¼ˆå¦‚ NFC Toolsï¼‰è®€å–æ‚¨çš„ NFC å¡ç‰‡</li>
                <li>å°‡è®€å–åˆ°çš„æ•¸æ“šè¼¸å…¥åˆ°ä¸Šæ–¹è¼¸å…¥æ¡†</li>
                <li>é»æ“Šã€Œé©—è­‰ä¸¦æ’­æ”¾ã€æŒ‰éˆ•</li>
            </ol>
            <p>NFC å¡ç‰‡æ•¸æ“šæ ¼å¼ï¼š</p>
            <pre>
{
  "imageUrl": "https://dl.dropboxusercontent.com/...",
  "audioUrl": "https://dl.dropboxusercontent.com/..."
}
            </pre>
        </div>

        <div id="content" class="hidden">
            <img id="imageDisplay" style="display: none;">
            
            <div class="audio-container">
                <div class="loop-icon">ğŸ”„</div>
                <audio id="audioPlayer" class="custom-audio" controls loop></audio>
            </div>
        </div>
    </div>

    <script>
        // æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´ Web NFC
        if (!('NDEFReader' in window)) {
            document.getElementById('status').className = 'status info';
            document.getElementById('status').textContent = 'è«‹ä½¿ç”¨ NFC è®€å–æ‡‰ç”¨ç¨‹å¼è®€å–å¡ç‰‡æ•¸æ“š';
            document.getElementById('otherBrowserSupport').classList.remove('hidden');
            document.getElementById('manualInput').classList.remove('hidden');
        } else {
            document.getElementById('webNfcSupport').classList.remove('hidden');
            // åˆå§‹åŒ– NFC è®€å–å™¨
            const ndef = new NDEFReader();
            
            // é–‹å§‹æƒæ NFC
            async function startScanning() {
                try {
                    await ndef.scan();
                    document.getElementById('status').className = 'status ready';
                    document.getElementById('status').textContent = 'è«‹å°‡ NFC å¡ç‰‡é è¿‘è¨­å‚™...';
                } catch (error) {
                    document.getElementById('status').className = 'status error';
                    document.getElementById('status').textContent = 'ç„¡æ³•å•Ÿå‹• NFC æƒæ: ' + error.message;
                    document.getElementById('otherBrowserSupport').classList.remove('hidden');
                    document.getElementById('manualInput').classList.remove('hidden');
                }
            }

            // è™•ç† NFC è®€å–äº‹ä»¶
            ndef.onreading = event => {
                const decoder = new TextDecoder();
                for (const record of event.message.records) {
                    if (record.recordType === "text") {
                        const text = decoder.decode(record.data);
                        handleNFCTag(text);
                    }
                }
            };

            // é–‹å§‹æƒæ
            startScanning();
        }

        // è™•ç†æ‰‹å‹•è¼¸å…¥
        function handleManualInput() {
            const input = document.getElementById('nfcData').value;
            if (input) {
                handleNFCTag(input);
            } else {
                document.getElementById('status').className = 'status error';
                document.getElementById('status').textContent = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„ NFC å¡ç‰‡æ•¸æ“š';
            }
        }

        // è™•ç† NFC æ¨™ç±¤å…§å®¹
        function handleNFCTag(content) {
            try {
                const data = JSON.parse(content);
                
                // è™•ç†åœ–ç‰‡
                if (data.imageUrl) {
                    const img = document.getElementById('imageDisplay');
                    img.onerror = function() {
                        document.getElementById('status').className = 'status error';
                        document.getElementById('status').textContent = 'ç„¡æ³•è¼‰å…¥åœ–ç‰‡ï¼Œè«‹ç¢ºèªé€£çµæ ¼å¼';
                    };
                    img.src = data.imageUrl;
                    img.style.display = 'block';
                }

                // è™•ç†éŸ³æ¨‚
                if (data.audioUrl) {
                    const audioPlayer = document.getElementById('audioPlayer');
                    audioPlayer.onerror = function() {
                        document.getElementById('status').className = 'status error';
                        document.getElementById('status').textContent = 'ç„¡æ³•æ’­æ”¾éŸ³æ¨‚ï¼Œè«‹ç¢ºèªé€£çµæ ¼å¼';
                    };
                    audioPlayer.src = data.audioUrl;
                    audioPlayer.loop = true;
                    
                    // è‡ªå‹•æ’­æ”¾
                    audioPlayer.play().catch(error => {
                        document.getElementById('status').className = 'status error';
                        document.getElementById('status').textContent = 'ç„¡æ³•è‡ªå‹•æ’­æ”¾ï¼Œè«‹é»æ“Šæ’­æ”¾æŒ‰éˆ•';
                    });
                }

                document.getElementById('status').className = 'status ready';
                document.getElementById('status').textContent = 'æ­£åœ¨æ’­æ”¾...';
                document.getElementById('content').classList.remove('hidden');
            } catch (error) {
                document.getElementById('status').className = 'status error';
                document.getElementById('status').textContent = 'ç„¡æ•ˆçš„ NFC å¡ç‰‡æ•¸æ“š';
            }
        }
    </script>
</body>
</html> 